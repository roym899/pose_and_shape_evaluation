
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://roym899.github.io/pose_and_shape_evaluation/api_reference/datasets/nocs_utils/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.1">
    
    
      
        <title>nocs_utils.py - Categorical Pose and Shape Evaluation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.e8d9bf0c.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../css/mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cpas_toolbox.datasets.nocs_utils" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Categorical Pose and Shape Evaluation" class="md-header__button md-logo" aria-label="Categorical Pose and Shape Evaluation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Categorical Pose and Shape Evaluation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              nocs_utils.py
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/roym899/pose_and_shape_evaluation/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    roym899/pose_and_shape_evaluation
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Categorical Pose and Shape Evaluation" class="md-nav__button md-logo" aria-label="Categorical Pose and Shape Evaluation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Categorical Pose and Shape Evaluation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/roym899/pose_and_shape_evaluation/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    roym899/pose_and_shape_evaluation
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Getting started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../data_preparation/" class="md-nav__link">
        Data preparation
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluate/" class="md-nav__link">
        evaluate.py
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          datasets
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="datasets" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          datasets
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nocs_dataset/" class="md-nav__link">
        nocs_dataset.py
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          nocs_utils.py
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        nocs_utils.py
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cpas_toolbox.datasets.nocs_utils.PoseEstimationError" class="md-nav__link">
    PoseEstimationError
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cpas_toolbox.datasets.nocs_utils.estimate_similarity_transform" class="md-nav__link">
    estimate_similarity_transform()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cpas_toolbox.datasets.nocs_utils._get_ransac_inliers" class="md-nav__link">
    _get_ransac_inliers()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cpas_toolbox.datasets.nocs_utils._evaluate_model" class="md-nav__link">
    _evaluate_model()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cpas_toolbox.datasets.nocs_utils._estimate_similarity_umeyama" class="md-nav__link">
    _estimate_similarity_umeyama()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../redwood_dataset/" class="md-nav__link">
        redwood_dataset.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../metrics/" class="md-nav__link">
        metrics.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../method_wrappers/" class="md-nav__link">
        method_wrappers.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../camera_utils/" class="md-nav__link">
        camera_utils.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pointset_utils/" class="md-nav__link">
        pointset_utils.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../quaternion_utils/" class="md-nav__link">
        quaternion_utils.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/" class="md-nav__link">
        utils.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cpas_toolbox.datasets.nocs_utils.PoseEstimationError" class="md-nav__link">
    PoseEstimationError
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cpas_toolbox.datasets.nocs_utils.estimate_similarity_transform" class="md-nav__link">
    estimate_similarity_transform()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cpas_toolbox.datasets.nocs_utils._get_ransac_inliers" class="md-nav__link">
    _get_ransac_inliers()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cpas_toolbox.datasets.nocs_utils._evaluate_model" class="md-nav__link">
    _evaluate_model()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cpas_toolbox.datasets.nocs_utils._estimate_similarity_umeyama" class="md-nav__link">
    _estimate_similarity_umeyama()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/roym899/pose_and_shape_evaluation/edit/master/docs/api_reference/datasets/nocs_utils.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



<div class="doc doc-object doc-module">



<h1 id="cpas_toolbox.datasets.nocs_utils" class="doc doc-heading">
        <code>cpas_toolbox.datasets.nocs_utils</code>



</h1>

    <div class="doc doc-contents first">


<details class="aligning-code-by-srinath-sridhar">
  <summary>Aligning code by Srinath Sridhar</summary>
  <p>https://raw.githubusercontent.com/hughw19/NOCS_CVPR2019/master/aligning.py</p>
</details>      <p>Module for utility function related to NOCS dataset.</p>
<p>This module contains functions to find similarity transform from NOCS maps and
evaluation function for typical metrics on the NOCS datasets.</p>
<p>Evaluation code by ... TODO</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h2 id="cpas_toolbox.datasets.nocs_utils.PoseEstimationError" class="doc doc-heading">
          <code>PoseEstimationError</code>



</h2>


    <div class="doc doc-contents ">
        <p class="doc doc-class-bases">
          Bases: <code>Exception</code></p>


      <p>Error if pose estimation encountered an error.</p>


          <details class="quote">
            <summary>Source code in <code>cpas_toolbox/datasets/nocs_utils.py</code></summary>
            <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">PoseEstimationError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Error if pose estimation encountered an error.&quot;&quot;&quot;</span>

    <span class="k">pass</span>
</code></pre></div>
</td></tr></table>
          </details>


    </div>

  </div>




  <div class="doc doc-object doc-function">



<h2 id="cpas_toolbox.datasets.nocs_utils.estimate_similarity_transform" class="doc doc-heading">
estimate_similarity_transform


</h2>
<div class="highlight"><pre><span></span><code><span class="n">estimate_similarity_transform</span><span class="p">(</span>
    <span class="n">source</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Estimate similarity transform from source to target from point correspondences.</p>
<p>Source and target are pairwise correponding pointsets, i.e., they include same
number of points and the first point of source corresponds to the first point of
target. RANSAC is used for outlier-robust estimation.</p>
<p>A similarity transform is estimated (i.e., isotropic scale, rotation and
translation) that transforms source points onto the target points.</p>
<p>Note that the returned values fulfill the following equations
    transform @ source_points = scale * rotation_matrix @ source_points + position
when ignoring homogeneous coordinate for left-hand side.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>source</code></td>
          <td class="doc-param-details">
            <p>Source points that will be transformed, shape (N,3).</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>target</code></td>
          <td class="doc-param-details">
            <p>Target points to which source will be aligned to, shape (N,3).</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td class="doc-param-details">
            <p>If true additional information will be printed.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>bool</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>False</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <code>position</code>
          </td>
          <td class="doc-returns-details">
            <p>Translation to translate source to target, shape (3,).</p>
              <p>
                <span class="doc-returns-annotation">
                  <b>TYPE:</b>
                    <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
                </span>
              </p>
          </td>
        </tr>
        <tr>
          <td>
              <code>rotation_matrix</code>
          </td>
          <td class="doc-returns-details">
            <p>Rotation to rotate source to target, shape (3,3).</p>
              <p>
                <span class="doc-returns-annotation">
                  <b>TYPE:</b>
                    <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
                </span>
              </p>
          </td>
        </tr>
        <tr>
          <td>
              <code>scale</code>
          </td>
          <td class="doc-returns-details">
            <p>Scaling factor along each axis, to scale source to target.</p>
              <p>
                <span class="doc-returns-annotation">
                  <b>TYPE:</b>
                    <code>float</code>
                </span>
              </p>
          </td>
        </tr>
        <tr>
          <td>
              <code>transform</code>
          </td>
          <td class="doc-returns-details">
            <p>Homogeneous transformation matrix, shape (4,4).</p>
              <p>
                <span class="doc-returns-annotation">
                  <b>TYPE:</b>
                    <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
                </span>
              </p>
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>cpas_toolbox/datasets/nocs_utils.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">estimate_similarity_transform</span><span class="p">(</span>
    <span class="n">source</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Estimate similarity transform from source to target from point correspondences.</span>

<span class="sd">    Source and target are pairwise correponding pointsets, i.e., they include same</span>
<span class="sd">    number of points and the first point of source corresponds to the first point of</span>
<span class="sd">    target. RANSAC is used for outlier-robust estimation.</span>

<span class="sd">    A similarity transform is estimated (i.e., isotropic scale, rotation and</span>
<span class="sd">    translation) that transforms source points onto the target points.</span>

<span class="sd">    Note that the returned values fulfill the following equations</span>
<span class="sd">        transform @ source_points = scale * rotation_matrix @ source_points + position</span>
<span class="sd">    when ignoring homogeneous coordinate for left-hand side.</span>

<span class="sd">    Args:</span>
<span class="sd">        source: Source points that will be transformed, shape (N,3).</span>
<span class="sd">        target: Target points to which source will be aligned to, shape (N,3).</span>
<span class="sd">        verbose: If true additional information will be printed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        position (np.ndarray): Translation to translate source to target, shape (3,).</span>
<span class="sd">        rotation_matrix (np.ndarray): Rotation to rotate source to target, shape (3,3).</span>
<span class="sd">        scale (float):</span>
<span class="sd">            Scaling factor along each axis, to scale source to target.</span>
<span class="sd">        transform (np.ndarray): Homogeneous transformation matrix, shape (4,4).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pose estimation failed. Not enough point correspondences: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="c1"># make points homogeneous</span>
    <span class="n">source_hom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">source</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">source</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">])]))</span>  <span class="c1"># 4,N</span>
    <span class="n">target_hom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">target</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">source</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">])]))</span>  <span class="c1"># 4,N</span>

    <span class="c1"># Auto-parameter selection based on source-target heuristics</span>
    <span class="n">target_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># mean distance from origin</span>
    <span class="n">source_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">ratio_ts</span> <span class="o">=</span> <span class="n">target_norm</span> <span class="o">/</span> <span class="n">source_norm</span>
    <span class="n">ratio_st</span> <span class="o">=</span> <span class="n">source_norm</span> <span class="o">/</span> <span class="n">target_norm</span>
    <span class="n">pass_t</span> <span class="o">=</span> <span class="n">ratio_st</span> <span class="k">if</span> <span class="p">(</span><span class="n">ratio_st</span> <span class="o">&gt;</span> <span class="n">ratio_ts</span><span class="p">)</span> <span class="k">else</span> <span class="n">ratio_ts</span>
    <span class="n">pass_t</span> <span class="o">*=</span> <span class="mf">0.01</span>  <span class="c1"># tighter bound</span>
    <span class="n">stop_t</span> <span class="o">=</span> <span class="n">pass_t</span> <span class="o">/</span> <span class="mi">100</span>
    <span class="n">n_iter</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pass threshold: &quot;</span><span class="p">,</span> <span class="n">pass_t</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stop threshold: &quot;</span><span class="p">,</span> <span class="n">stop_t</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of iterations: &quot;</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">)</span>

    <span class="n">source_inliers_hom</span><span class="p">,</span> <span class="n">target_inliers_hom</span><span class="p">,</span> <span class="n">best_inlier_ratio</span> <span class="o">=</span> <span class="n">_get_ransac_inliers</span><span class="p">(</span>
        <span class="n">source_hom</span><span class="p">,</span>
        <span class="n">target_hom</span><span class="p">,</span>
        <span class="n">max_iterations</span><span class="o">=</span><span class="n">n_iter</span><span class="p">,</span>
        <span class="n">pass_threshold</span><span class="o">=</span><span class="n">pass_t</span><span class="p">,</span>
        <span class="n">stop_threshold</span><span class="o">=</span><span class="n">stop_t</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">best_inlier_ratio</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pose estimation failed. Small inlier ratio: &quot;</span><span class="p">,</span> <span class="n">best_inlier_ratio</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="n">scales</span><span class="p">,</span> <span class="n">rotation_matrix</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">out_transform</span> <span class="o">=</span> <span class="n">_estimate_similarity_umeyama</span><span class="p">(</span>
        <span class="n">source_inliers_hom</span><span class="p">,</span> <span class="n">target_inliers_hom</span>
    <span class="p">)</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">scales</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BestInlierRatio:&quot;</span><span class="p">,</span> <span class="n">best_inlier_ratio</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rotation:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">rotation_matrix</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Position:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scales:&quot;</span><span class="p">,</span> <span class="n">scales</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">position</span><span class="p">,</span> <span class="n">rotation_matrix</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">out_transform</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="cpas_toolbox.datasets.nocs_utils._get_ransac_inliers" class="doc doc-heading">
_get_ransac_inliers


</h2>
<div class="highlight"><pre><span></span><code><span class="n">_get_ransac_inliers</span><span class="p">(</span>
    <span class="n">source_hom</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">target_hom</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">pass_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
    <span class="n">stop_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Apply RANSAC and return set of inliers.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>source_hom</code></td>
          <td class="doc-param-details">
            <p>Homogeneous coordinates of source points, shape (4,N).</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>target_hom</code></td>
          <td class="doc-param-details">
            <p>Homogeneous coordinates of target points, shape (4,N).</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>max_iterations</code></td>
          <td class="doc-param-details">
            <p>Maximum number of RANSAC iterations.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>int</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>100</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>pass_threshold</code></td>
          <td class="doc-param-details">
            <p>Threshold at which a point correspondence is considered good.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>float</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>200</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>stop_threshold</code></td>
          <td class="doc-param-details">
            <p>If residual is below this threshold, RANSAC will stop early.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>float</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>1</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <code>source_inliers</code>
          </td>
          <td class="doc-returns-details">
            <p>Homogeneous coordinates of inlier source points, shape (4,M).</p>
              <p>
                <span class="doc-returns-annotation">
                  <b>TYPE:</b>
                    <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
                </span>
              </p>
          </td>
        </tr>
        <tr>
          <td>
              <code>target_inliers</code>
          </td>
          <td class="doc-returns-details">
            <p>Homogeneous coordinates of inlier target points, shape (4,M).</p>
              <p>
                <span class="doc-returns-annotation">
                  <b>TYPE:</b>
                    <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
                </span>
              </p>
          </td>
        </tr>
        <tr>
          <td>
              <code>inlier_ratio</code>
          </td>
          <td class="doc-returns-details">
            <p>Ratio of inliers and outliers.</p>
              <p>
                <span class="doc-returns-annotation">
                  <b>TYPE:</b>
                    <code>float</code>
                </span>
              </p>
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>cpas_toolbox/datasets/nocs_utils.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_get_ransac_inliers</span><span class="p">(</span>
    <span class="n">source_hom</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">target_hom</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">pass_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
    <span class="n">stop_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Apply RANSAC and return set of inliers.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_hom: Homogeneous coordinates of source points, shape (4,N).</span>
<span class="sd">        target_hom: Homogeneous coordinates of target points, shape (4,N).</span>
<span class="sd">        max_iterations: Maximum number of RANSAC iterations.</span>
<span class="sd">        pass_threshold: Threshold at which a point correspondence is considered good.</span>
<span class="sd">        stop_threshold: If residual is below this threshold, RANSAC will stop early.</span>

<span class="sd">    Returns:</span>
<span class="sd">        source_inliers (np.ndarray):</span>
<span class="sd">            Homogeneous coordinates of inlier source points, shape (4,M).</span>
<span class="sd">        target_inliers (np.ndarray):</span>
<span class="sd">            Homogeneous coordinates of inlier target points, shape (4,M).</span>
<span class="sd">        inlier_ratio (float): Ratio of inliers and outliers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">best_residual</span> <span class="o">=</span> <span class="mf">1e10</span>
    <span class="n">best_inlier_ratio</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">best_inlier_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">source_hom</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_iterations</span><span class="p">):</span>
        <span class="c1"># Pick 5 random (but corresponding) points from source and target without repl.</span>
        <span class="n">rand_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
            <span class="n">source_hom</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="c1"># rand_idx = np.random.randint(source_hom.shape[1], size=10)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">out_transform</span> <span class="o">=</span> <span class="n">_estimate_similarity_umeyama</span><span class="p">(</span>
            <span class="n">source_hom</span><span class="p">[:,</span> <span class="n">rand_idx</span><span class="p">],</span> <span class="n">target_hom</span><span class="p">[:,</span> <span class="n">rand_idx</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">residual</span><span class="p">,</span> <span class="n">inlier_ratio</span><span class="p">,</span> <span class="n">inlier_idx</span> <span class="o">=</span> <span class="n">_evaluate_model</span><span class="p">(</span>
            <span class="n">out_transform</span><span class="p">,</span> <span class="n">source_hom</span><span class="p">,</span> <span class="n">target_hom</span><span class="p">,</span> <span class="n">pass_threshold</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">residual</span> <span class="o">&lt;</span> <span class="n">best_residual</span><span class="p">:</span>
            <span class="n">best_residual</span> <span class="o">=</span> <span class="n">residual</span>
            <span class="n">best_inlier_ratio</span> <span class="o">=</span> <span class="n">inlier_ratio</span>
            <span class="n">best_inlier_idx</span> <span class="o">=</span> <span class="n">inlier_idx</span>
        <span class="k">if</span> <span class="n">best_residual</span> <span class="o">&lt;</span> <span class="n">stop_threshold</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="c1"># print(&#39;Iteration: &#39;, i)</span>
        <span class="c1"># print(&#39;Residual: &#39;, Residual)</span>
        <span class="c1"># print(&#39;Inlier ratio: &#39;, InlierRatio)</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="n">source_hom</span><span class="p">[:,</span> <span class="n">best_inlier_idx</span><span class="p">],</span>
        <span class="n">target_hom</span><span class="p">[:,</span> <span class="n">best_inlier_idx</span><span class="p">],</span>
        <span class="n">best_inlier_ratio</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="cpas_toolbox.datasets.nocs_utils._evaluate_model" class="doc doc-heading">
_evaluate_model


</h2>
<div class="highlight"><pre><span></span><code><span class="n">_evaluate_model</span><span class="p">(</span>
    <span class="n">out_transform</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">source_hom</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">target_hom</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">pass_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Evaluate transformation from source to target points.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>out_transform</code></td>
          <td class="doc-param-details">
            <p>Transformation which will be applied to source points, shape (4,4).</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>source_hom</code></td>
          <td class="doc-param-details">
            <p>Homogeneous coordinates of source points, shape (4,N).</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>target_hom</code></td>
          <td class="doc-param-details">
            <p>Homogeneous coordinates of target points, shape (4,N).</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>pass_threshold</code></td>
          <td class="doc-param-details">
            <p>Threshold at which a point correspondence is considered good.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>float</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <code>residual</code>
          </td>
          <td class="doc-returns-details">
            <p>The mean error between transformed source and target.</p>
              <p>
                <span class="doc-returns-annotation">
                  <b>TYPE:</b>
                    <code>float</code>
                </span>
              </p>
          </td>
        </tr>
        <tr>
          <td>
              <code>inlier_ratio</code>
          </td>
          <td class="doc-returns-details">
            <p>Ratio between inliers and number of correspondences (i.e., N).</p>
              <p>
                <span class="doc-returns-annotation">
                  <b>TYPE:</b>
                    <code>float</code>
                </span>
              </p>
          </td>
        </tr>
        <tr>
          <td>
              <code>inlier_idx</code>
          </td>
          <td class="doc-returns-details">
            <p>Array containing the indices of inliers, shape (M,).</p>
              <p>
                <span class="doc-returns-annotation">
                  <b>TYPE:</b>
                    <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
                </span>
              </p>
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>cpas_toolbox/datasets/nocs_utils.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_evaluate_model</span><span class="p">(</span>
    <span class="n">out_transform</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">source_hom</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">target_hom</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">pass_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Evaluate transformation from source to target points.</span>

<span class="sd">    Args:</span>
<span class="sd">        out_transform:</span>
<span class="sd">            Transformation which will be applied to source points, shape (4,4).</span>
<span class="sd">        source_hom: Homogeneous coordinates of source points, shape (4,N).</span>
<span class="sd">        target_hom: Homogeneous coordinates of target points, shape (4,N).</span>
<span class="sd">        pass_threshold: Threshold at which a point correspondence is considered good.</span>

<span class="sd">    Returns:</span>
<span class="sd">        residual (float): The mean error between transformed source and target.</span>
<span class="sd">        inlier_ratio (float):</span>
<span class="sd">            Ratio between inliers and number of correspondences (i.e., N).</span>
<span class="sd">        inlier_idx (np.ndarray): Array containing the indices of inliers, shape (M,).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">target_hom</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">out_transform</span><span class="p">,</span> <span class="n">source_hom</span><span class="p">)</span>
    <span class="n">residual_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">diff</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># shape (N,)</span>
    <span class="n">residual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">residual_vec</span><span class="p">)</span>
    <span class="n">inlier_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">residual_vec</span> <span class="o">&lt;</span> <span class="n">pass_threshold</span><span class="p">)</span>
    <span class="n">n_inliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">inlier_idx</span><span class="p">)</span>
    <span class="n">inlier_ratio</span> <span class="o">=</span> <span class="n">n_inliers</span> <span class="o">/</span> <span class="n">source_hom</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">residual</span><span class="p">,</span> <span class="n">inlier_ratio</span><span class="p">,</span> <span class="n">inlier_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="cpas_toolbox.datasets.nocs_utils._estimate_similarity_umeyama" class="doc doc-heading">
_estimate_similarity_umeyama


</h2>
<div class="highlight"><pre><span></span><code><span class="n">_estimate_similarity_umeyama</span><span class="p">(</span>
    <span class="n">source_hom</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">target_hom</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Calculate similarity transform from 3D point correspondences.</p>
<p>A similarity transform is calculated (i.e., isotropic scale, rotation and
translation) that transforms source points such that squared Euclidean distance
between transformed source points and target points is minimized.</p>
<p>Original algorithm from Least-squares estimation of transformation parameters
between two point patterns, Umeyama, 1991.
http://web.stanford.edu/class/cs273/refs/umeyama.pdf</p>
<p>The returned scale, rotation, translation, describe the same transformation as the
homogeneous transformation matrix as (np notation):
    scale * rotation @ point + translation &lt;=&gt; transformation @ point_hom.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>source_hom</code></td>
          <td class="doc-param-details">
            <p>Homogeneous coordinates of 5 source points, shape (4,M).</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>target_hom</code></td>
          <td class="doc-param-details">
            <p>Homogeneous coordinates of 5 target points, shape (4,M).</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <code>scales</code>
          </td>
          <td class="doc-returns-details">
            <p>Scaling factors along each axis, to scale source to target, shape (3,).
This will always be three times the same value, since similarity transforms
only include isotropic scaling.</p>
              <p>
                <span class="doc-returns-annotation">
                  <b>TYPE:</b>
                    <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
                </span>
              </p>
          </td>
        </tr>
        <tr>
          <td>
              <code>rotation</code>
          </td>
          <td class="doc-returns-details">
            <p>Rotation to rotate source to target, shape (3,).</p>
              <p>
                <span class="doc-returns-annotation">
                  <b>TYPE:</b>
                    <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
                </span>
              </p>
          </td>
        </tr>
        <tr>
          <td>
              <code>translation</code>
          </td>
          <td class="doc-returns-details">
            <p>Translation to translate source to target, shape (3,).</p>
              <p>
                <span class="doc-returns-annotation">
                  <b>TYPE:</b>
                    <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
                </span>
              </p>
          </td>
        </tr>
        <tr>
          <td>
              <code>transform</code>
          </td>
          <td class="doc-returns-details">
            <p>Homogeneous transformation matrix, shape (4,4).</p>
              <p>
                <span class="doc-returns-annotation">
                  <b>TYPE:</b>
                    <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
                </span>
              </p>
          </td>
        </tr>
    </tbody>
  </table>

        <details class="quote">
          <summary>Source code in <code>cpas_toolbox/datasets/nocs_utils.py</code></summary>
          <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">_estimate_similarity_umeyama</span><span class="p">(</span>
    <span class="n">source_hom</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">target_hom</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Calculate similarity transform from 3D point correspondences.</span>

<span class="sd">    A similarity transform is calculated (i.e., isotropic scale, rotation and</span>
<span class="sd">    translation) that transforms source points such that squared Euclidean distance</span>
<span class="sd">    between transformed source points and target points is minimized.</span>

<span class="sd">    Original algorithm from Least-squares estimation of transformation parameters</span>
<span class="sd">    between two point patterns, Umeyama, 1991.</span>
<span class="sd">    http://web.stanford.edu/class/cs273/refs/umeyama.pdf</span>

<span class="sd">    The returned scale, rotation, translation, describe the same transformation as the</span>
<span class="sd">    homogeneous transformation matrix as (np notation):</span>
<span class="sd">        scale * rotation @ point + translation &lt;=&gt; transformation @ point_hom.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_hom: Homogeneous coordinates of 5 source points, shape (4,M).</span>
<span class="sd">        target_hom: Homogeneous coordinates of 5 target points, shape (4,M).</span>

<span class="sd">    Returns:</span>
<span class="sd">        scales (np.ndarray):</span>
<span class="sd">            Scaling factors along each axis, to scale source to target, shape (3,).</span>
<span class="sd">            This will always be three times the same value, since similarity transforms</span>
<span class="sd">            only include isotropic scaling.</span>
<span class="sd">        rotation (np.ndarray): Rotation to rotate source to target, shape (3,).</span>
<span class="sd">        translation (np.ndarray): Translation to translate source to target, shape (3,).</span>
<span class="sd">        transform (np.ndarray): Homogeneous transformation matrix, shape (4,4).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">source_centroid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">source_hom</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># shape (3,)</span>
    <span class="n">target_centroid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">target_hom</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># shape (3,)</span>
    <span class="n">n_points</span> <span class="o">=</span> <span class="n">source_hom</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">centered_source</span> <span class="o">=</span> <span class="n">source_hom</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">source_centroid</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>  <span class="c1"># shape (3, N)</span>
    <span class="n">centered_target</span> <span class="o">=</span> <span class="n">target_hom</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">target_centroid</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>  <span class="c1"># shape (3, N)</span>

    <span class="n">cov_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">centered_target</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">centered_source</span><span class="p">))</span> <span class="o">/</span> <span class="n">n_points</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">cov_matrix</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nPoints:&quot;</span><span class="p">,</span> <span class="n">n_points</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">source_hom</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">target_hom</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;There are NANs in the input.&quot;</span><span class="p">)</span>

    <span class="n">u</span><span class="p">,</span> <span class="n">diag_values</span><span class="p">,</span> <span class="n">vh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">cov_matrix</span><span class="p">,</span> <span class="n">full_matrices</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">diag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">diag_values</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">cov_matrix</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">rotation</span> <span class="o">=</span> <span class="n">u</span> <span class="o">@</span> <span class="n">s</span> <span class="o">@</span> <span class="n">vh</span>

    <span class="n">var_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">source_hom</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">var_p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pose estimation failed: 0 variance in sampled points.&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">source_hom</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">PoseEstimationError</span><span class="p">()</span>
    <span class="n">scale_fact</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">var_p</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">s</span> <span class="o">@</span> <span class="n">diag</span><span class="p">)</span>  <span class="c1"># scale factor</span>
    <span class="n">scales</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">scale_fact</span><span class="p">,</span> <span class="n">scale_fact</span><span class="p">,</span> <span class="n">scale_fact</span><span class="p">])</span>
    <span class="n">scales_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span>

    <span class="n">translation</span> <span class="o">=</span> <span class="n">target_centroid</span> <span class="o">-</span> <span class="n">scales_matrix</span> <span class="o">@</span> <span class="n">rotation</span> <span class="o">@</span> <span class="n">source_centroid</span>

    <span class="c1"># create homogeneous transformation from scale, rotation and translation</span>
    <span class="n">out_transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">out_transform</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">scales_matrix</span> <span class="o">@</span> <span class="n">rotation</span>
    <span class="n">out_transform</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">translation</span>

    <span class="k">return</span> <span class="n">scales</span><span class="p">,</span> <span class="n">rotation</span><span class="p">,</span> <span class="n">translation</span><span class="p">,</span> <span class="n">out_transform</span>
</code></pre></div>
</td></tr></table>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../nocs_dataset/" class="md-footer__link md-footer__link--prev" aria-label="Previous: nocs_dataset.py" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              nocs_dataset.py
            </div>
          </div>
        </a>
      
      
        
        <a href="../redwood_dataset/" class="md-footer__link md-footer__link--next" aria-label="Next: redwood_dataset.py" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              redwood_dataset.py
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.bd0b6b67.min.js"}</script>
    
    
      <script src="../../../assets/javascripts/bundle.8aa65030.min.js"></script>
      
    
  </body>
</html>